jQuery( document ).ready( function($) {
	//set default selection to single side 
	$("#form-58 > div.required-product-addon.product-addon.product-addon-einstellungen > p > select, #form-54 > div.product-addon.product-addon-einstellungen > p > select, #form-129 > div.product-addon.product-addon-einstellungen > p > select, #form-189 > div.product-addon.product-addon-einstellungen > p > select,#form-190 > div.product-addon.product-addon-einstellungen > p > select, #form-191 > div.product-addon.product-addon-einstellungen > p > select,#form-192 > div.product-addon.product-addon-einstellungen > p > select,#form-193 > div.product-addon.product-addon-einstellungen > p > select,#form-194 > div.product-addon.product-addon-einstellungen > p > select").val('einseitig-1');	
	$("#form-54 > div.product-addon.product-addon-deckblatt > p > select,#form-189 > div.required-product-addon.product-addon.product-addon-deckblatt > p > select").val('transparent-folie-1');		
	$("#form-54 > div.product-addon.product-addon-ruckseite > p > select,#form-189 > div.required-product-addon.product-addon.product-addon-rueckseite > p > select,#form-54 > div.product-addon.product-addon-rueckseite > p > select").val('transparent-folie-1');		
	$("#form-129 > div.product-addon.product-addon-farbe-von-abdeckung > p > select").val('schwarz-1');	
	$("#form-192 > div.product-addon.product-addon-falzart > p > select").val('einfach-falz-1');	
	$("#form-193 > div.product-addon.product-addon-heften > p > select").val('links-oben-1');
	$("#form-194 > div.required-product-addon.product-addon.product-addon-lochen > p > select").val('2-fach-lochen-1');
	$("#form-54 > div.product-addon.product-addon-metall-farbe > p > select").val('silber-1');
	$.fn.init_addon_totals = function(){

		var $cart = $( this );

		// Clear all values on variable product when clear selection is clicked
		$( this ).on( 'click', '.reset_variations', function() {

			$.each( $cart.find( '.product-addon' ), function() {
				var element = $( this ).find( '.addon' );

				if ( element.is( ':checkbox' ) || element.is( ':radio' ) ) {
					element.prop( 'checked', false );
				}

				if ( element.is( 'select' ) ) {
					element.prop( 'selectedIndex', 0 );
				}

				if ( element.is( ':text' ) || element.is( 'textarea' ) || element.is( 'input[type="number"]' ) || element.is( 'input[type="file"]' ) ) {
					element.val( '' );
				}
			});

			$cart.trigger( 'woocommerce-product-addons-update' );
		});

		$( this ).on( 'keyup change', '.product-addon input, .product-addon textarea', function() {

			if ( $( this ).attr( 'maxlength' ) > 0 ) {

				var value = $( this ).val();
				var remaining = $( this ).attr( 'maxlength' ) - value.length;

				$( this ).next( '.chars_remaining' ).find( 'span' ).text( remaining );
			}

		});

		$( this ).find( ' .addon-custom, .addon-custom-textarea' ).each( function() {

			if ( $( this ).attr( 'maxlength' ) > 0 ) {

				$( this ).after( '<small class="chars_remaining"><span>' + $( this ).attr( 'maxlength' ) + '</span> ' + woocommerce_addons_params.i18n_remaining + '</small>' );

			}
		});
		/*custom keyup function*/
		$(".addon-input_multiplier").bind("keyup change", function(e) {
			var name = $(this).attr('name');
			if(name=='addon-58-farbige-seiten-1[0]'|| name=='addon-54-farbige-seiten-1[0]' || name=='addon-129-farbige-seiten-1[0]' || name=='addon-189-farbige-seiten-1[0]' || name=='addon-190-farbige-seiten-1[0]' || name == 'addon-191-farbige-seiten-1[0]' || name == 'addon-192-farbige-seiten-1[0]' || name == 'addon-193-farbige-seiten-1[0]' || name == 'addon-194-farbige-seiten-1[0]'){
				
			   jQuery('select#pa_farbauswahl').val('farbig').trigger('change');

			}else if(name=='addon-58-sw-seiten-0[pages]' || name == 'addon-54-sw-seiten-0[0]' || name == 'addon-129-sw-seiten-0[0]' || name=='addon-189-sw-seiten-0[0]' || name =='addon-190-sw-seiten-0[0]' || name =='addon-191-sw-seiten-0[0]' || name =='addon-192-sw-seiten-0[0]'  || name =='addon-193-sw-seiten-0[0]' || name =='addon-194-sw-seiten-0[0]'){
				
			   jQuery('select#pa_farbauswahl').val('schwarz-weis').trigger('change');

			} 
			//console.log(name);
			
		})


		/*end*/
		$( this ).on( 'change', '.product-addon input, .product-addon textarea, .product-addon select, input.qty', function() {
			
			/*jQuery('select#pa_farbauswahl option:contains("farbig")').prop('selected',true);*/
					
			$( this ).trigger( 'woocommerce-product-addons-update' );

		});

		/* to add default value to input  field of addon and limit min val to 0*/

		$( this ).on( 'change', '.product-addon input',function(){
			var typeOfInput = $(this).attr('type');
			if(typeOfInput=='number'){
				if($(this).val() == ''){
				
				$(this).val(0);
				$(this).attr('min',0);
				}
			}
			
		});
		/* to make choose an option disabled */
		/*$('form select option').each( function(){
			if($(this).text() == 'Choose an option'){
				$(this).attr('disabled','disabled');
			}
		});*/

		$('#pa_papier-format,#pa_papier-grammatur').on('change',function(){
			$('#pa_farbauswahl').focus();

			/*$('#pa_farbauswahl').val('schwarz-weis').trigger('change');
			$('#pa_farbauswahl').val('farbig').trigger('change');*/

			$("#pa_farbauswahl option").each(function()
			{
				if($(this).val() != ''){
					var option = $(this).val();
					//console.log(option);
			    	$('#pa_farbauswahl').val(option).trigger('change');
				}
			});
		});


		$( this ).on( 'found_variation', function( event, variation ) {
						
			var $variation_form = $( this );
			var $totals         = $variation_form.find( '#product-addons-total' );

			if ( typeof( variation.display_price ) !== 'undefined' ) {

				$totals.data( 'price', variation.display_price );

			} else if ( $( variation.price_html ).find( '.amount:last' ).size() ) {

				product_price = $( variation.price_html ).find( '.amount:last' ).text();
				product_price = product_price.replace( woocommerce_addons_params.currency_format_symbol, '' );
				product_price = product_price.replace( woocommerce_addons_params.currency_format_thousand_sep, '' );
				product_price = product_price.replace( woocommerce_addons_params.currency_format_decimal_sep, '.' );
				product_price = product_price.replace(/[^0-9\.]/g, '' );
				product_price = parseFloat( product_price );

				$totals.data( 'price', product_price );
			}

			$variation_form.trigger( 'woocommerce-product-addons-update' );
		});

		$( this ).on( 'woocommerce-product-addons-update', function() {

			var total         = 0;
			var $totals       = $cart.find( '#product-addons-total' );
			var product_price = $totals.data( 'price' );
			var product_type  = $totals.data( 'type' );
			var product_id    = $totals.data( 'product-id' );
			//console.log(product_price);
			// We will need some data about tax modes (both store and display)
			// and 'raw prices' (prices that don't take into account taxes) so we can use them in some
			// instances without making an ajax call to calculate taxes
			var product_raw      = $totals.data( 'raw-price' );
			var tax_mode         = $totals.data( 'tax-mode' );
			var tax_display_mode = $totals.data( 'tax-display-mode' );
			var total_raw        = 0;
			var initial_price = product_price;
			//console.log('raw price ='+product_raw+" product price="+product_price);
			// Move totals
			if ( product_type == 'variable' || product_type == 'variable-subscription' ) {
				$cart.find( '.single_variation' ).after( $totals );
			}
  
  			var val = $('#pa_farbauswahl option:selected').val();
  			//console.log(val);
			if(val == 'farbig'){
				$("input[name='addon-58-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-54-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-129-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-189-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-190-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-191-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-192-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-193-farbige-seiten-1[0]'").attr('data-p',product_price);
				$("input[name='addon-194-farbige-seiten-1[0]'").attr('data-p',product_price);

			} else if(val == 'schwarz-weis'){
				$("input[name='addon-58-sw-seiten-0[pages]'").attr('data-p',product_price);	
				$("input[name='addon-54-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-129-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-190-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-191-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-192-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-193-sw-seiten-0[0]'").attr('data-p',product_price);	
				$("input[name='addon-194-sw-seiten-0[0]'").attr('data-p',product_price);	

			}
			/*Double side price reduction*/
			//$('.addon-select').change(function(){
				
			//});

			$cart.find( '.addon' ).each( function() {	
				//console.log(this);

			/*var a4 = $('input[name="addon-198-simple-product-0[a4]"]').val();
			var a3 = $('input[name="addon-198-simple-product-0[a3]"]').val();
			*/
				var addon_cost = 0;
				var addon_cost_raw = 0;
				
				//console.log(name);
				
				if ( $( this ).is( '.addon-custom-price' ) ) {
					addon_cost = $( this ).val();
				} else if ( $( this ).is( '.addon-input_multiplier' ) ) {

					if( isNaN( $( this ).val() ) || $( this ).val() == "" ) { // Number inputs return blank when invalid
						$( this ).val( '' );
						$( this ).closest( 'p' ).find( '.addon-alert' ).show();
					} else {
						if( $( this ).val() != "" ){
							$( this ).val( Math.ceil( $( this ).val() ) );
						}
						$( this ).closest( 'p' ).find( '.addon-alert' ).hide();
					}
				var paperprice = 0;	
				var cost =new Array();
				cost['farbiges-papier']  = 0.02;
				cost['80g']  = 0.01;
				cost['100g'] = 0.04;
				cost['120g'] = 0.10;
				cost['160g'] = 0.20;
				cost['210g'] = 0.40;
				cost['250g'] = 0.50;
				cost['300g'] = 0.60;

				var blacknwhite= new Array();
				blacknwhite['1-100'] 	= 0.03;
				blacknwhite['101-500'] 	= 0.03;
				blacknwhite['500+'] 	= 0.03;

				var color= new Array();
				color['1-20'] 	    = 0.15;
				color['21-100'] 	= 0.15;
				color['101-200'] 	= 0.15;
				color['201-500']	= 0.15;
				color['500+']	    = 0.15;
				var bindungCost =0;
				var reducedAmountBlack =0;
				var reducedAmountColor =0;
				inputQuantity =$('.quantity input').val();
				var selectedpaper = $("#pa_papier-format").val();
				var colorselection = $('#pa_farbauswahl').val();
				var sideSetting = $("#form-58 > div.required-product-addon.product-addon.product-addon-einstellungen > p > select, #form-54 > div.product-addon.product-addon-einstellungen > p > select, #form-129 > div.product-addon.product-addon-einstellungen > p > select, #form-189 > div.product-addon.product-addon-einstellungen > p > select, #form-190 > div.product-addon.product-addon-einstellungen > p > select, #form-191 > div.product-addon.product-addon-einstellungen > p > select,#form-192 > div.product-addon.product-addon-einstellungen > p > select,#form-193 > div.product-addon.product-addon-einstellungen > p > select,#form-194 > div.product-addon.product-addon-einstellungen > p > select").val();
				if ($(".product").attr('id') == "product-58") {
					var noofpagesblack =$('.addon-wrap-58-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-58-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-54"){
					var noofpagesblack =$('.addon-wrap-54-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-54-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-129"){
					var noofpagesblack =$('.addon-wrap-129-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-129-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-189"){
					var noofpagesblack =$('.addon-wrap-189-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-189-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-190"){
					var noofpagesblack =$('.addon-wrap-190-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-190-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-191"){
					var noofpagesblack =$('.addon-wrap-191-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-191-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-192"){
					var noofpagesblack =$('.addon-wrap-192-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-192-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-193"){
					var noofpagesblack =$('.addon-wrap-193-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-193-farbige-seiten-1 input').val();
				}else if($(".product").attr('id') == "product-194"){
					var noofpagesblack =$('.addon-wrap-194-sw-seiten-0 input').val();
					var noofpagescolor =$('.addon-wrap-194-farbige-seiten-1 input').val();
				}

				if(sideSetting == 'einseitig-1'){
					noOfSheets = Math.ceil(noofpagesblack) + Math.ceil(noofpagescolor) ; // no of sheet for binding

				}else if(sideSetting =='doppelseitig-2'){
					noOfSheets = Math.ceil(noofpagesblack/2) + Math.ceil(noofpagescolor/2) ; // no of sheet for binding

				}else{
					noOfSheets = Math.ceil(noofpagesblack) + Math.ceil(noofpagescolor) ; // no of sheet for binding
				}

				//console.log('noOfSheets='+noOfSheets);
				if($('.product').attr('id') == 'product-54'){
					if(noOfSheets == 0){

						bindungCost=0;

					}else if (noOfSheets>= 1 && noOfSheets <= 50) {
						if (inputQuantity>=1 && inputQuantity<=10) {
							bindungCost = 2.5;

						}else if (inputQuantity>10 && inputQuantity<=50) {
							bindungCost = 2;

						}else if (inputQuantity>50 && inputQuantity<=100) {
							bindungCost = 1.7;

						}else if (inputQuantity>100 ) {
							bindungCost = 1.5;

						}
						$('button[type="submit"]').prop('disabled', false);
						$('.error-message').html('');
					}else if (noOfSheets> 50 && noOfSheets <= 100) {
						if (inputQuantity>=1 && inputQuantity<=10) {
							bindungCost = 3;
						}else if (inputQuantity>10 && inputQuantity<=50) {
							bindungCost = 2.5;
						}else if (inputQuantity>50 && inputQuantity<=100) {
							bindungCost = 2.3;
						}else if (inputQuantity>100 ) {
							bindungCost = 2;
						}
						$('button[type="submit"]').prop('disabled', false);
						$('.error-message').html('');

					}else if (noOfSheets> 100 && noOfSheets <= 150) {
						if (inputQuantity>=1 && inputQuantity<=10) {
							bindungCost = 3.5;
						}else if (inputQuantity>10 && inputQuantity<=50) {
							bindungCost = 3;
						}else if (inputQuantity>50 && inputQuantity<=100) {
							bindungCost = 2.7;
						}else if (inputQuantity>100 ) {
							bindungCost = 2.5;
						}
						$('button[type="submit"]').prop('disabled', false);
						$('.error-message').html('');

					}else if (noOfSheets> 150 && noOfSheets <= 200) {
						if (inputQuantity>=1 && inputQuantity<=10) {
							bindungCost = 4;
						}else if (inputQuantity>10 && inputQuantity<=50) {
							bindungCost = 3.5;
						}else if (inputQuantity>50 && inputQuantity<=100) {
							bindungCost = 3.2;
						}else if (inputQuantity>100 ) {
							bindungCost = 3;
						}
						$('button[type="submit"]').prop('disabled', false);
						$('.error-message').html('');

					}else if (noOfSheets> 200 && noOfSheets <= 280) {
						if (inputQuantity>=1 && inputQuantity<=10) {
							bindungCost = 4.5;
						}else if (inputQuantity>10 && inputQuantity<=50) {
							bindungCost = 4;
						}else if (inputQuantity>50 && inputQuantity<=100) {
							bindungCost = 3.5;
						}else if (inputQuantity>100 ) {
							bindungCost = 3.2;
						}
						$('button[type="submit"]').prop('disabled', false);
						$('.error-message').html('');
					}else{
						
							// bindung not possible
						$('button[type="submit"]').prop('disabled', true);
					 	$('.error-message').html('Bindungsgrenze überschritten, Anzahl der Papier sollte weniger als 281');	 

					}
				}
				//hardcover bindung
			if($('.product').attr('id') == 'product-129'){ 
				if(noOfSheets == 0){
					bindungCost = 0;
					
				}else if (noOfSheets >= 1 && noOfSheets <= 150) {
					if (inputQuantity >=1 && inputQuantity <=3) {
						bindungCost = 9;

					}else if (inputQuantity >3 && inputQuantity <=7) {
						bindungCost = 8;

					}else if (inputQuantity >7 && inputQuantity <= 10) {
						bindungCost = 7.5;

					}else if (inputQuantity >10 ) {
						bindungCost = 7;

					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else if (noOfSheets> 150 && noOfSheets <= 245) {
					if (inputQuantity >= 1 && inputQuantity <= 3) {
						bindungCost = 10;
					}else if (inputQuantity > 3 && inputQuantity <=7) {
						bindungCost = 9;
					}else if (inputQuantity > 7 && inputQuantity <=10) {
						bindungCost = 8.5;
					}else if (inputQuantity > 10 ) {
						bindungCost = 8;
					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else{
					
	// bindung not possible
						$('button[type="submit"]').prop('disabled', true);
					 	$('.error-message').html('Bindungsgrenze überschritten, Anzahl der Papier sollte weniger als 246');	 


				}

			}
			if($('.product').attr('id') == 'product-189'){ 
				if (noOfSheets==0) {
					bindungCost =0;
				}else if (noOfSheets >= 1 && noOfSheets <= 150) {
					if (inputQuantity >=1 && inputQuantity <=10) {
						bindungCost = 3.50;

					}else if (inputQuantity >10 && inputQuantity <=50) {
						bindungCost = 3.3;

					}else if (inputQuantity >50 && inputQuantity <= 100) {
						bindungCost = 3.2;

					}else if (inputQuantity >100 ) {
						bindungCost = 3;

					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else if (noOfSheets> 150 && noOfSheets <= 350) {
					if (inputQuantity >= 1 && inputQuantity <= 10) {
						bindungCost = 4;
					}else if (inputQuantity > 3 && inputQuantity <=7) {
						bindungCost = 3.7;
					}else if (inputQuantity > 7 && inputQuantity <=10) {
						bindungCost = 3.4;
					}else if (inputQuantity > 10 ) {
						bindungCost = 3.2;
					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else{
					
// bindung not possible

						$('button[type="submit"]').prop('disabled', true);
					 	$('.error-message').html('Bindungsgrenze überschritten, Anzahl der Papier sollte weniger als 350');	 


				}

			}	
			if($('.product').attr('id') == 'product-190'){ 
				if (noOfSheets >= 1 && noOfSheets <= 150) {
					if (inputQuantity >=1 && inputQuantity <=10) {
						bindungCost = 4;

					}else if (inputQuantity >10 && inputQuantity <=50) {
						bindungCost = 3.5;

					}else if (inputQuantity >50 && inputQuantity <= 100) {
						bindungCost = 3.3;

					}else if (inputQuantity >100 ) {
						bindungCost = 3;

					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else if (noOfSheets> 150 && noOfSheets <= 250) {
					if (inputQuantity >= 1 && inputQuantity <= 10) {
						bindungCost = 5;
					}else if (inputQuantity > 3 && inputQuantity <=7) {
						bindungCost = 4.5;
					}else if (inputQuantity > 7 && inputQuantity <=10) {
						bindungCost = 4;
					}else if (inputQuantity > 10 ) {
						bindungCost = 3.5;
					}
					$('button[type="submit"]').prop('disabled', false);
					$('.error-message').html('');
				}else{
					
// bindung not possible
					$('button[type="submit"]').prop('disabled', true);
					$('.error-message').html('Bindungsgrenze überschritten, Anzahl der Papier sollte weniger als 250');	 



				}

			}
			if($('.product').attr('id') == 'product-191'){ 
				if(inputQuantity >0 && inputQuantity<10 ){
					bindungCost = 0.60;
				}else if(inputQuantity >9 && inputQuantity<50 ){
					bindungCost = 0.50;
				}else if(inputQuantity >49 && inputQuantity<100 ){
					bindungCost = 0.45;
				}else if(inputQuantity >100){
					bindungCost = 0.40;
				}

			}	
				noofpagesblack=noofpagesblack*inputQuantity;
				noofpagescolor=noofpagescolor*inputQuantity;
				//console.log(selectedpaper);
				if(selectedpaper=='a4'||selectedpaper=='a5'){
					/*if(colorselection=='schwarz-weis'){*/
						if(noofpagesblack>100 && noofpagesblack<501){
							reducedAmountBlack = noofpagesblack*(0.03-blacknwhite['101-500']);
						//console.log('reduced amount black='+reducedAmountBlack);
							
						}else if(noofpagesblack>500){
							reducedAmountBlack = noofpagesblack*(0.03-blacknwhite['500+']);
						//console.log('reduced amount black='+reducedAmountBlack);
							
						}

						
					/*}else if(colorselection=='farbig'){*/
						if(noofpagescolor>20 && noofpagescolor<101){

							reducedAmountColor = noofpagescolor*( 0.15-color['21-100']);
							//console.log('reducedAmountColor='+reducedAmountColor);


						}else if(noofpagescolor>100 && noofpagescolor<201){

							reducedAmountColor = noofpagescolor*( 0.15-color['101-200']);

						}else if(noofpagescolor>200 && noofpagescolor<501){

							reducedAmountColor = noofpagescolor*( 0.15-color['201-500']);

						}else if(noofpagescolor>500){

							reducedAmountColor = noofpagescolor*( 0.15-color['500+']);

						}
					/*}*/

				}else if(selectedpaper='a3'){
					/*if(colorselection=='schwarz-weis'){*/
						if(noofpagesblack>100 && noofpagesblack<501){
							reducedAmountBlack = noofpagesblack*(0.06-2*blacknwhite['101-500']);
							
						}else if(noofpagesblack>500){
							reducedAmountBlack = noofpagesblack*(0.06-2*blacknwhite['500+']);
							
						}	

						
					/*}else if(colorselection=='farbig'){*/
						if(noofpagescolor>20 && noofpagescolor<101){

							reducedAmountColor = noofpagescolor*(0.30-2*color['21-100']);
						}else if(noofpagescolor>100 && noofpagescolor<201){

							reducedAmountColor = noofpagescolor*(0.30-2*color['101-200']);

						}else if(noofpagescolor>200 && noofpagescolor<501){

							reducedAmountColor = noofpagescolor*(0.30-2*color['201-500']);

						}else if(noofpagescolor>500){

							reducedAmountColor = noofpagescolor*(0.30-2*color['500+']);

						}
					/*}*/
				}	

				if(sideSetting =='doppelseitig-2'){
					var key = $('#pa_papier-grammatur').val();
					$('.addon-wrap-58-drehen-an-3').closest('div').show();
					$('.addon-wrap-54-drehen-an-3').closest('div').show();
					$('.addon-wrap-189-drehen-an-3').closest('div').show();
					$('.addon-wrap-190-drehen-an-3').closest('div').show();
					$('.addon-wrap-192-drehen-an-3').closest('div').show();
					$('.addon-wrap-193-drehen-an-3').closest('div').show();
					$('.addon-wrap-194-drehen-an-3').closest('div').show();
					
					var noofpaper = $( this ).val();
					paperprice = Math.floor(noofpaper/2) * cost[key];
					var paperFormat = $('#pa_papier-format').val();
					//console.log(paperFormat);

					if(paperFormat == 'a3'){
						paperprice=paperprice*2;

					}
					//console.log(paperprice);
				//console.log(noofpaper+'  '+key);
					
				}else{
					$('.addon-wrap-58-drehen-an-3').closest('div').hide();
					$('.addon-wrap-54-drehen-an-3').closest('div').hide();
					$('.addon-wrap-189-drehen-an-3').closest('div').hide();
					$('.addon-wrap-190-drehen-an-3').closest('div').hide();
					$('.addon-wrap-192-drehen-an-3').closest('div').hide();
					$('.addon-wrap-193-drehen-an-3').closest('div').hide();
					$('.addon-wrap-194-drehen-an-3').closest('div').hide();


				}
				if(($("#form-54 > div.product-addon.product-addon-deckblatt > p > select").val()||$("#form-189 > div.required-product-addon.product-addon.product-addon-deckblatt > p > select").val())!='transparent-folie-1'){
					$('.product-addon-deckblatt-bedrucken').closest('div').show();
					$('#form-189 > div.required-product-addon.product-addon.product-addon-deckblatt-bedrucken').closest('div').show();
				}else{
					$('.product-addon-deckblatt-bedrucken').closest('div').hide();	
					$('#form-189 > div.required-product-addon.product-addon.product-addon-deckblatt-bedrucken').closest('div').hide();	
				}
				var truncated = Math.floor((reducedAmountColor +reducedAmountBlack)/2 * 1000) / 1000;
				
				if(bindungCost != 0){
					$('#bindungCost').removeClass('hidden');
					$('#bindungtotal').html(bindungCost+' €');
				}else{
					$('#bindungCost').addClass('hidden');
					
				}
				//console.log(reducedAmountBlack+' '+reducedAmountColor+' key='+key);
			//	console.log( bindungCost );
					addon_cost = $( this ).attr( 'data-p' ) * $( this ).val()-parseFloat(paperprice)-truncated/inputQuantity+bindungCost/2 ;
				//console.log('paperprice='+paperprice+' truncated='+truncated/inputQuantity+' data-p='+$( this ).attr( 'data-p' ) * $( this ).val());
				//	console.log(addon_cost);
					//addon_cost_raw = $( this ).data( 'raw-price' ) * $( this ).val();
					//console.log(addon_cost+' '+product_price);
					/*addon_cost = $( this ).data( 'price' ) * $( this ).val();
					addon_cost_raw = $( this ).data( 'raw-price' ) * $( this ).val();*/
					//console.log(addon_cost);

						//console.log('a4 value = '+a4+ ' '+'a3 value = '+a3);
					
					/*var reduce_amount = 0;
					if(a4 > 10 && a4 <= 20){
						reduce_amount = a4*(1-0.90);
					} else if(a4 > 20){
						reduce_amount = a4*(1-0.80);
					}

					console.log(reduce_amount);*/

				} else if ( $( this ).is( '.addon-checkbox, .addon-radio' ) ) {

					if ( $( this ).is( ':checked' ) ) {
						addon_cost = $( this ).data( 'price' );
						addon_cost_raw = $( this ).data( 'raw-price' );
					}
				} else if ( $( this ).is( '.addon-select' ) ) {

					if ( $( this ).val() ) {
						addon_cost = $( this ).find( 'option:selected' ).data( 'price' );
						addon_cost_raw = $( this ).find( 'option:selected' ).data( 'raw-price' );
					}
				} else {
					if ( $( this ).val() ) {
						addon_cost = $( this ).data( 'price' );
						addon_cost_raw = $( this ).data( 'raw-price' );
					}
				}

				if ( ! addon_cost ) {
					addon_cost = 0;
				}
				if ( ! addon_cost_raw ) {
					addon_cost_raw = 0;
				}

				total = parseFloat( total ) + parseFloat( addon_cost );// - parseFloat(reduce_amount/2);
				total_raw = parseFloat( total_raw ) + parseFloat( addon_cost_raw );
				
			} );

			$totals.data( 'addons-price', total );
			$totals.data( 'addons-raw-price', total_raw );

			if ( $cart.find( 'input.qty' ).size() ) {
				var qty = parseFloat( $cart.find( 'input.qty' ).val() );
			} else {
				var qty = 1;
			}


			if(total == 0  ){

				if($('.woocommerce-page').hasClass('postid-9')){

				var formatted_initial_price = accounting.formatMoney( initial_price, {
					symbol 		: woocommerce_addons_params.currency_format_symbol,
					decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
					thousand	: woocommerce_addons_params.currency_format_thousand_sep,
					precision 	: woocommerce_addons_params.currency_format_num_decimals,
					format		: woocommerce_addons_params.currency_format
				});					
				}else{
					//	console.log(initial_price);
				var formatted_initial_price = accounting.formatMoney( initial_price-product_price, {
					symbol 		: woocommerce_addons_params.currency_format_symbol,
					decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
					thousand	: woocommerce_addons_params.currency_format_thousand_sep,
					precision 	: woocommerce_addons_params.currency_format_num_decimals,
					format		: woocommerce_addons_params.currency_format
				});
				}
				$('#grandtotal').html(formatted_initial_price);
			
			}

			//console.log(total);
			if ( total > 0 && qty > 0 ) {

				var product_total_price, product_total_raw_price;

				total     = parseFloat( total * qty );
				total_raw = parseFloat( total_raw * qty );
				//console.log(total);
				var formatted_addon_total = accounting.formatMoney( total, {
					symbol 		: woocommerce_addons_params.currency_format_symbol,
					decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
					thousand	: woocommerce_addons_params.currency_format_thousand_sep,
					precision 	: woocommerce_addons_params.currency_format_num_decimals,
					format		: woocommerce_addons_params.currency_format
				});

				if ( 'undefined' !== typeof product_price ) {

					var id=$('.product').attr('id');
					if(id=='product-58' || id=='product-54' || id=='product-129' || id=='product-189' || id=='product-190' || id=='product-191'|| id=='product-192' || id=='product-193'|| id=='product-194'){
							product_total_price = 0;

					}else{
						product_total_price = parseFloat( product_price * qty );

					}

					//console.log(product_total_price+' '+product_price);
					var formatted_grand_total = accounting.formatMoney( product_total_price + total, {
						symbol 		: woocommerce_addons_params.currency_format_symbol,
						decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
						thousand	: woocommerce_addons_params.currency_format_thousand_sep,
						precision 	: woocommerce_addons_params.currency_format_num_decimals,
						format		: woocommerce_addons_params.currency_format
					});

				}

				product_total_raw_price = parseFloat( product_raw * qty );

				var formatted_raw_total = accounting.formatMoney( product_total_raw_price + total_raw, {
					symbol 		: woocommerce_addons_params.currency_format_symbol,
					decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
					thousand	: woocommerce_addons_params.currency_format_thousand_sep,
					precision 	: woocommerce_addons_params.currency_format_num_decimals,
					format		: woocommerce_addons_params.currency_format
				});

				var subscription_details = false;

				if ( $( '.entry-summary .subscription-details' ).length ) {
					subscription_details = $( '.entry-summary .subscription-details' ).clone().wrap( '<p>' ).parent().html();
				}

				if ( subscription_details ) {
					formatted_addon_total += subscription_details;
					if ( formatted_grand_total ) {
						formatted_grand_total += subscription_details;
					}
				}
				$('#grandtotal').html(formatted_grand_total);
				var html = '<dl class="product-addon-totals"><dt>' + woocommerce_addons_params.i18n_addon_total + '</dt><dd><strong><span class="amount">' + formatted_addon_total + '</span></strong></dd>';

				if ( formatted_grand_total && '1' == $totals.data( 'show-grand-total' ) ) {

					// To show our "price display suffix" we have to do some magic since the string can contain variables (excl/incl tax values)
					// so we have to take our grand total and find out what the tax value is, which we can do via an ajax call
					// if its a simple string, or no string at all, we can output the string without an extra call
					var price_display_suffix = '';

					// no sufix is present, so we can just output the total
					if ( ! woocommerce_addons_params.price_display_suffix ) {
						html = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span></strong></dd></dl>';
						$totals.html( html );
						$cart.trigger( 'updated_addons' );
						return;
					}

					// a suffix is present, but no special labels are used - meaning we don't need to figure out any other special values - just display the playintext value
					if ( false === ( woocommerce_addons_params.price_display_suffix.indexOf( '{price_including_tax}' ) > -1 ) && false === ( woocommerce_addons_params.price_display_suffix.indexOf( '{price_excluding_tax}' ) > -1 ) ) {
						html = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span> ' + woocommerce_addons_params.price_display_suffix + '</strong></dd></dl>';
						$totals.html( html );
						$cart.trigger( 'updated_addons' );
						return;
					}

					// If prices are entered exclusive of tax but display inclusive, we have enough data from our totals above
					// to do a simple replacement and output the totals string
					if (  'excl' === tax_mode && 'incl' === tax_display_mode ) {
						price_display_suffix = '<small class="woocommerce-price-suffix">' + woocommerce_addons_params.price_display_suffix + '</small>';
						price_display_suffix = price_display_suffix.replace( '{price_including_tax}', formatted_grand_total );
						price_display_suffix = price_display_suffix.replace( '{price_excluding_tax}', formatted_raw_total );
						html                 = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span> ' + price_display_suffix + ' </strong></dd></dl>';
						$totals.html( html );
						$cart.trigger( 'updated_addons' );
						return;
					}

					// Prices are entered inclusive of tax mode but displayed exclusive, we have enough data from our totals above
					// to do a simple replacement and output the totals string.
					if ( 'incl' === tax_mode && 'excl' === tax_display_mode ) {
						price_display_suffix = '<small class="woocommerce-price-suffix">' + woocommerce_addons_params.price_display_suffix + '</small>';
						price_display_suffix = price_display_suffix.replace( '{price_including_tax}', formatted_raw_total );
						price_display_suffix = price_display_suffix.replace( '{price_excluding_tax}', formatted_grand_total );
						html                 = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span> ' + price_display_suffix + ' </strong></dd></dl>';
						$totals.html( html );
						$cart.trigger( 'updated_addons' );
						return;
					}

					// Based on the totals/info and settings we have, we need to use the get_price_*_tax functions
					// to get accurate totals. We can get these values with a special Ajax function
					$.ajax( {
						type: 'POST',
						url:  woocommerce_addons_params.ajax_url,
						data: {
							action: 'wc_product_addons_calculate_tax',
							total:  product_total_price + total,
							product_id: product_id
						},
						success: 	function( code ) {
							result = $.parseJSON( code );
							if ( result.result == 'SUCCESS' ) {
								price_display_suffix = '<small class="woocommerce-price-suffix">' + woocommerce_addons_params.price_display_suffix + '</small>';
								var formatted_price_including_tax = accounting.formatMoney( result.price_including_tax, {
									symbol 		: woocommerce_addons_params.currency_format_symbol,
									decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
									thousand	: woocommerce_addons_params.currency_format_thousand_sep,
									precision 	: woocommerce_addons_params.currency_format_num_decimals,
									format		: woocommerce_addons_params.currency_format
								} );
								var formatted_price_excluding_tax = accounting.formatMoney( result.price_excluding_tax, {
									symbol 		: woocommerce_addons_params.currency_format_symbol,
									decimal 	: woocommerce_addons_params.currency_format_decimal_sep,
									thousand	: woocommerce_addons_params.currency_format_thousand_sep,
									precision 	: woocommerce_addons_params.currency_format_num_decimals,
									format		: woocommerce_addons_params.currency_format
								} );
								price_display_suffix = price_display_suffix.replace( '{price_including_tax}', formatted_price_including_tax );
								price_display_suffix = price_display_suffix.replace( '{price_excluding_tax}', formatted_price_excluding_tax );
								html                 = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span> ' + price_display_suffix + ' </strong></dd></dl>';
								$totals.html( html );
								$cart.trigger( 'updated_addons' );
							} else {
								html = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span></strong></dd></dl>';
								$totals.html( html );
								$cart.trigger( 'updated_addons' );
							}
						},
						error: function() {
							html = html + '<dt>' + woocommerce_addons_params.i18n_grand_total + '</dt><dd><strong><span class="amount">' + formatted_grand_total + '</span></strong></dd></dl>';
							$totals.html( html );
							$cart.trigger( 'updated_addons' );
						}
					});
				} else {
					$totals.empty();
					$cart.trigger( 'updated_addons' );
				}
			} else {
				$totals.empty();
				$cart.trigger( 'updated_addons' );
			}

		});

		$( this ).find( '.addon-custom, .addon-custom-textarea, .product-addon input, .product-addon textarea, .product-addon select, input.qty' ).change();

		// When default variation exists, 'found_variation' must be triggered
		$( this ).find( '.variations select' ).change();
	}

	// Quick view
	$( 'body' ).on( 'quick-view-displayed', function() {
		$( this ).find( '.cart:not(.cart_group)' ).each( function() {
			$( this ).init_addon_totals();
		});
	});

	// Composites
	$( 'body .component' ).on( 'wc-composite-component-loaded', function() {
		$( this ).find( '.cart' ).each( function() {
			$( this ).init_addon_totals();
		});
	});

	// Initialize
	$( 'body' ).find( '.cart:not(.cart_group)' ).each( function() {
		$( this ).init_addon_totals();
	});

});
